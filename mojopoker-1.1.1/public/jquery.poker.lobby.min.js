(function(e,d,a){e.widget("poker.lobby",{options:{widthToHeight:4/3,epochDiff:0,inchan:{},colData:{1:["Id","int"],2:["Stakes","string"],3:["Limit","string"],4:["Seats","int"],5:["Plrs","string"],6:["Wait","int"],7:["Avg Pot","int"],8:["Plrs/Flop","int"],9:["H/hr","int"],10:["Start","int"],11:["Game","string"],12:["Buy-In","int"],13:["State","string"],14:["Enrolled","int"],15:["Table","int"],16:["Speed","string"],17:["Login","string"],18:["Name","string"],19:["Location","string"],20:["Player","string"],21:["Chips","int"],22:["Seat","int"],23:["Block","int"],24:["Player Pool","int"],25:["Rank","int"],26:["Rating","int"]},ringCols:[1,11,2,3,4,5,7,8,9],leaderCols:[25,20,26],socialCols:[17,18,19],hydraCols:[1,11,2,3,4,24],loginData:{},ringData:{},fastData:{},gameState:{0:"Closed",1:"Registering",2:"Late Reg.",3:"Full",4:"Playing",6:"Complete"},gameTabs:{dealers:["Dealer's Choice",1],holdem:["Hold'em",1],holdemjokers:["Hold'em (Jokers Wild)",1],pineapple:["Pineapple",1],crazypine:["Crazy Pineapple",1],omaha:["Omaha",1],omahahilo:["Omaha Hi-Lo",1],omahafive:["5 Card Omaha",2],omahafivehilo:["5 Card Omaha Hi-Lo",2],courcheval:["Courcheval",2],courchevalhilo:["Courcheval Hi-Lo",2],fivedraw:["5 Card Draw",2],drawjokers:["5 Card Draw (Jokers Wild)",2],drawdeuces:["5 Card Draw (Deuces)",3],singledraw27:["2-7 Single Draw",3],tripledraw27:["2-7 Triple Draw",3],singledrawa5:["A-5 Single Draw",3],tripledrawa5:["A-5 Triple Draw",3],sevenstud:["7 Card Stud",3],razz:["Razz",3],sevenstudhilo:["7 Card Stud Hi-Lo",4],sevenstudjokers:["7 Card Stud (Jokers)",4],highchicago:["High Chicago",4],ftq:["Follow the Queen",4],bitch:["The Bitch",4],badugi:["Badugi",4],badacey:["Badacey",4],badeucy:["Badeucy",4]}},_create:function(){var y=this,u=y.options,t=y.element;var m=c("<div />").attr("id","tabs");var n=c("<div />").attr({id:"game-tabs1",type:"game"});var o=c("<div />").attr({id:"game-tabs2",type:"game"});var p=c("<div />").attr({id:"game-tabs3",type:"game"});var r=c("<div />").attr({id:"game-tabs4",type:"game"});var x=c("<input />").attr({id:"social-input",type:"text",maxlength:30});var s=t.addClass("ui-widget").append(c("<div />").attr("id","lobby-header"),c("<div />").attr("id","lobby-leader").append(y._buildTable(u.leaderCols)),c("<div />").attr("id","lobby-countdown"),c("<div />").attr("id","lobby-adspace"),c("<div />").attr("id","lobby-logins"),c("<div/>").attr("id","welcome"),c("<button />)").attr("id","lobby-red").html("Log-In").click(function(){c("#login-box").show();c("#login-name").focus()}),c("<div />").attr("id","login-box").addClass("lobby-modal"),c("<div />").attr("id","modal-box").addClass("lobby-modal"),c("<div />").attr("id","new-account").addClass("lobby-modal"),c("<div />").attr("id","ring-info").addClass("tab-info games").append(y._buildTable(u.ringCols)),m.append(n.append(c("<button />").attr({id:"all-tab",info:"all"}).addClass("lobby-tab").html("All")),o,p,r),c("<div />").attr("id","social-box").append(c("<div />").attr("id","chat-header"),c("<div />").attr("id","main-chat"),c("<form />").attr("id","social-form").append(x).submit(function(f){f.preventDefault();var h=/^[\w\s\.\,\?!@#\$%^&\*\(\)_]{0,30}$/;if(h.test(x.val())){var g="main";c("#poker-main").main("write_channel",{channel:g,message:x.val()})}x.val("")})));e.each(u.gameTabs,function(g,f){t.find("#game-tabs"+f[1]).append(c("<button />").attr({id:g+"-tab",info:g}).addClass("lobby-tab").html(f[0]))});s.on("click","#tabs .lobby-tab",function(){var f=c(this);t.find("#tabs > [type="+f.parent().attr("type")+"] .lobby-tab.select").removeClass("select");f.addClass("select")}).on("click","#tabs > [type=game] .lobby-tab",function(){var g=c(this).attr("info");var f=t.find(".tab-info.games tbody tr");if(g=="all"){f.show()}else{f.filter("[game_class="+g+"]").show();f.filter("[game_class!="+g+"]").hide()}}).on("click",".tab-info tbody tr",function(){var f=c(this);f.siblings().removeClass("select");f.addClass("select")}).on("click","#ring-info tbody tr",function(){var f=c(this).attr("table_id");c("#poker-main").main("watch_table",{table_id:f})}).on("dblclick","#tour-info tbody tr",function(){var f=c(this).attr("tour_id");c("#poker-main").main("watch_tour",{tour_id:f})}).on("mouseenter","button.lobby-tab",function(){c(this).addClass("tab-hover")}).on("mouseleave","button.lobby-tab",function(){c(this).removeClass("tab-hover")});c(b).resize(function(){y.resizeLobby()});y.resizeLobby();y._buildLogin();y._buildReg();x.focus()},_filter_money:function(n){var o=this,j=o.options,m=o.element;var l=m.find(".tab-info.games.select tbody tr:visible");if(n=="real"){l.filter("[did!=1]").show();l.filter("[did=1]").hide()}else{if(n=="play"){l.filter("[did=1]").show();l.filter("[did!=1]").hide()}}},watch_table_res:function(l){var m=this,i=m.options,j=m.element;c("#table-ring").append(c("<div />").attr("id","tring"+l.table_id).table_ring(l))},_destroy:function(){},destroy:function(){},_buildReg:function(){var s=this,u=s.options,p=s.element,t=c("<input />").attr({id:"signup-name",name:"username",placeholder:"Username",type:"text",maxlength:12,pattern:"[A-Za-z]([0-9a-zA-Z_]){3,12}"}).prop({autofocus:true,required:true}),r=c("<input />").attr({id:"signup-email",placeholder:"Email (optional)",maxlength:30,name:"email",type:"email"}).prop({required:true}),q=c("<input />").attr({id:"signup-pass",placeholder:"Password",maxlength:12,name:"password",type:"password"}).prop({required:true}),f=c("<input />").attr({id:"confirm-pass",placeholder:"Confirm Password",maxlength:12,name:"password",type:"password"}).prop({required:true});var o=p.find("#new-account");o.append(c("<div />").addClass("modal-header").html("Create New Account"),c("<form />").attr("id","signup-form").append(c("<div />").attr("id","signup-un").html("Username:"),t,c("<div />").attr("id","signup-pw").html("Password:"),q,c("<div />").attr("id","signup-cp").html("Password:"),f,c("<div />").attr("id","signup-em").html("Email:"),r).submit(function(g){g.preventDefault();o.hide();if(q.val()!==f.val()){s.modal_message("Passwords don't match")}else{var h={username:t.val(),password:q.val()};if(r.val()){h.email=r.val()}c("#poker-main").main("register",h)}}),c("<button />").addClass("modal-ok").html("OK").click(function(){c("#signup-form").submit()}),c("<button />").addClass("modal-cancel").html("Cancel").click(function(){o.hide()}))},register_res:function(h){var i=this;var j;if(h.success){j="Registered! Welcome "+h.username+"!";i.login_success(h)}else{j=h.message}this.modal_message(j)},_buildLogin:function(){var p=this,f=p.options,n=p.element,m=n.find("#login-box"),q=c("<input />").attr({id:"login-name",name:"username",placeholder:"Username",type:"text",maxlength:12,pattern:"[A-Za-z]([0-9a-zA-Z_]){3,12}"}).prop({autofocus:true,required:true}),o=c("<input />").attr({id:"login-pass",placeholder:"Password",maxlength:12,name:"password",type:"password"}).prop({required:true});m.append(c("<div />").addClass("modal-header").html("Log-In"),c("<form />").attr("id","login-form").append(c("<div />").attr("id","label-name").html("Username:"),q,c("<div />").attr("id","label-pass").html("Password:"),o).submit(function(g){g.preventDefault();c("#poker-main").main("login",{username:q.val(),password:o.val()});m.hide()}),c("<button />").attr({id:"login-create"}).html("Create New Account").click(function(){m.hide();c("#new-account").show();c("#signup-name").focus()}),c("<button />").addClass("modal-ok").html("OK").click(function(){c("#login-form").submit()}),c("<button />").addClass("modal-cancel").html("Cancel").click(function(){m.hide()}))},_updateClock:function(){var s=this,o=s.options,r=s.element;var p=(new Date).toTimeString().split(/\s/);var m=p[2].replace(/\W/g,"");var q=p[0].split(":");var n=q[0]+":"+q[1]+" "+m;r.find("#lobby-clock").html(n)},_buildTable:function(l){var o=this,j=o.options,m=o.element;var n="";e.each(l,function(f,h){var i=j.colData[h][0];var g=j.colData[h][1];n+='<th data-sort-dir="asc" data-sort="'+g+'">'+i+"</th>"});return c("<div/>").addClass("table-box").append(c("<table />").append(c("<thead />").append(c("<tr>").html(n)),c("<tbody />")).stupidtable().bind("aftertablesort",function(g,i){$this=c(this);var h=$this.find("th");h.find(".arro").remove();var f=i.direction==="asc"?"↑":"↓";h.eq(i.column).append('<span class="arro">'+f+"</span>")}))},resizeLobby:function(m){var i=this.options,l=d.innerWidth*0.9,f=d.innerHeight*0.9,j=l/f;if(j>i.widthToHeight){l=f*i.widthToHeight}else{f=l/i.widthToHeight}this.element.css({height:f+"px",width:l+"px",marginTop:(-f/2)+"px",marginLeft:(-l/2)+"px",fontSize:(l/680)+"em"})},guest_login:function(l){var m=this,i=m.options,j=m.element;i.epochDiff=(new Date).getTime()-(l.epoch*1000);i.myData={login_id:l.login_id,username:l.username,chips:l.chips};m._updateClock();clearInterval(i.clockTimer);setTimeout(function(){m._updateClock();i.clockTimer=setInterval(function(){m._updateClock()},60000)},(62-(new Date).getSeconds()));j.find("#welcome").empty().append(c("<div/>").attr("id","username").html(i.myData.username),c("<div/>").attr("id","logout").html("&nbsp[ Logout ]").click(function(){c("#poker-main").main("logout")}))},modal_message:function(m){var n=this,p=this.element.find("#modal-box"),l=c("<div />").addClass("modal-mes").html(m),q=c("<button />").addClass("modal-ok center").html("OK"),o=p.width();p.append(l,q.click(function(){p.hide()})).show();setTimeout(function(){p.fadeOut(1200,function(){c(this).children().remove()})},2000)},_buildCashier:function(l){var m=this,i=m.options,j=m.element;j.append(c("<div />").attr("id","cashier").addClass("big-modal").append(c("<div />").attr("id","cash-head").html("CASHIER"),c("<div />").attr("id","cash-close").click(function(){c("#cashier").hide()}),c("<div />").attr("id","cash-one").append(c("<div />").attr("id","pers-head").addClass("head").html("Personal Information"),c("<div />").attr("id","cash-user").addClass("cash-block").append(c("<div />").addClass("cash-cat").html("Username:"),c("<div />").addClass("cash-det")),c("<div />").attr("id","cash-email").addClass("cash-block").append(c("<div />").addClass("cash-cat").html("Email:"),c("<div />").addClass("cash-det")),c("<div />").attr("id","cash-deposit").addClass("cash-block").append(c("<div />").addClass("cash-cat").html("Rating:"),c("<div />").addClass("cash-det").html("0"))),c("<div />").attr("id","cash-two").append(c("<div />").attr("id","acct-head").addClass("head").html("Account Balance"),c("<div />").attr("id","play-head").addClass("head").html("PLAY MONEY"),c("<div />").attr("id","play-avail").addClass("cash-block").append(c("<div />").addClass("cash-cat").html("Available:"),c("<div />").addClass("cash-det")),c("<div />").attr("id","play-inplay").addClass("cash-block").append(c("<div />").addClass("cash-cat").html("In Play:"),c("<div />").addClass("cash-det")),c("<div />").attr("id","play-total").append(c("<div />").addClass("cash-cat").html("Total:"),c("<div />").addClass("cash-det"))),c("<div />").attr("id","cash-three").append(c("<button />").attr("id","cash-reload").html("Reload Chips").click(function(){c("#poker-main").main("reload")}),c("<button />").attr("id","cash-leave").html("Leave Cashier").click(function(){c("#cashier").hide()}))))},_updateCashier:function(){var n=this,j=n.options,l=n.element;var m;var o={username:function(f){c("#cash-user .cash-det").html(f)},email:function(f){c("#cash-email .cash-det").html(f)},chips:function(f){c("#real-avail .cash-det").html(0);c("#play-avail .cash-det").html(f[1])},ring_play:function(g){var f=0;var h=0;e.each(g,function(i,p){if(j.ringData[i].director_id==1){f+=p}else{h+=p}});m=f+j.myData.chips[1];c("#real-inplay .cash-det").html(h);c("#real-total .cash-det").html(h);c("#play-inplay .cash-det").html(f);c("#play-total .cash-det").html(m)}};e.each(j.myData,function(g,f){if(g in o){o[g](f)}});c("#cash-deposit .cash-det").html(m+"/"+j.myData.invested[1]+" = "+Math.round(m/j.myData.invested[1]*1000)/1000)},login_success:function(l){var m=this,i=m.options,j=m.element;i.myData=l;m._buildCashier();j.find("#lobby-red").html("Cashier").off("click").click(function(){c("#poker-main").main("login_info")});j.find("#username").html(i.myData.username)},login_res:function(l){var m=this,i=m.options,j=m.element;if(l.success){m.modal_message("Success! Welcome "+l.username+"!");m.login_success(l)}else{m.modal_message(l.message)}},login_update:function(l){var m=this,i=m.options,j=m.element;i.myData=l},login_info_res:function(l){var m=this,i=m.options,j=m.element;if(l.success){i.myData=l;m._updateCashier();c("#cashier").show()}else{m.modal_message(l.message)}},join_channel_res:function(l){var m=this,i=m.options,j=m.element;i.inchan[l.channel]=l.success?true:false},unjoin_channel_res:function(l){var m=this,i=m.options,j=m.element;i.inchan[l.channel]=l.success?false:true},notify_message:function(s){var t=this,o=t.options,r=t.element;if(o.loginData[s.from]&&o.loginData[s.from]["block"]){return}var n=o.loginData[s.from];var q=n?n.username:"Guest"+s.from;var p=n?n.color:"black";var u=r.find("#"+s.channel+"-chat");u.append(c("<div />").addClass("chat-msg").append(c("<a />").addClass("chat-handle").html(q).css("color",p),c("<span />").html(": "+s.message)));u.animate({scrollTop:u[0].scrollHeight})},notify_login:function(l){var m=this,i=m.options,j=m.element;this.notify_logout(l);l.color="rgb("+Math.floor(Math.random()*256)+","+Math.floor(Math.random()*256)+","+Math.floor(Math.random()*256)+")";i.loginData[l.login_id]=l;j.find("#social-info .table-box tbody").append(c("<tr />").attr("login_id",l.login_id).append(c("<td />").html(l.username),c("<td />").addClass("block yes").click(function(){var f=c(this);f.toggleClass("yes");if(f.hasClass("yes")){i.loginData[l.login_id]["block"]=true;f.html("Yes")}else{i.loginData[l.login_id]["block"]=false;f.html("No")}}).click()))},notify_logout:function(l){var m=this,i=m.options,j=m.element;delete i.loginData[l.login_id];j.find("#social-info .table-box tbody tr[login_id="+l.login_id+"]").remove()},ring_snap:function(l){var m=this,i=m.options,j=m.element;e.each(l,function(g,f){i.ringData[f.table_id]=f});m._build_ring_tab()},_build_ring_tab:function(){var m=this,i=m.options,j=m.element;var l=j.find("#ring-info tbody");l.empty();e.each(i.ringData,function(g,h){var f=h.small_blind+"/"+h.big_blind;var n=h.game_class=="dealers"?"--":h.limit;c("<tr />").attr({id:"lring"+g,table_id:h.table_id,did:h.director_id,game_class:h.game_class}).addClass("lring").append(c("<td />").addClass("table-id").html(h.table_id),c("<td />").html(i.gameTabs[h.game_class][0]),c("<td />").addClass().html(f),c("<td />").addClass().html(n),c("<td />").addClass().html(h.chair_count),c("<td />").addClass("plr-count"),c("<td />").addClass("avg-pot"),c("<td />").addClass("plrs-flop"),c("<td />").addClass("hhr")).appendTo(l);m._update_ring_tab(h)});j.find("#all-tab").trigger("click");j.find("#ring-info thead th:eq(5)").trigger("click")},notify_create_ring:function(l){var m=this,i=m.options,j=m.element;i.ringData[l.table_id]=l;m._build_ring_tab()},notify_destroy_ring:function(f){delete this.options.ringData[f.table_id];this.element.find("#lring"+f.table_id).remove()},notify_lr_update:function(l){var m=this,i=m.options,j=m.element;e.extend(i.ringData[l.table_id],l);m._update_ring_tab(l)},_update_ring_tab:function(o){var p=this,l=p.options,m=p.element;var n=m.find("#lring"+o.table_id);var q={avg_pot:function(f){n.find(".avg-pot").html(f)},plrs_flop:function(f){n.find(".plrs-flop").html(f)},hhr:function(f){n.find(".hhr").html(f)},plr_map:function(f){var h=n.find(".plr-count");var g=0;for(k in f){g++}h.html(g)}};e.each(o,function(g,f){if(g in q){q[g](f)}})},_msgHandler:function(h,i){var j={};if(h in j){j[h](i)}},_setOption:function(o,m){var p=this,l=p.options,n=p.element;var q={};if(o in q){l[o]=m;q[o](m)}}})})(jQuery,window,document);