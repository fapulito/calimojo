(function(c,b,a,d){c.widget("poker.table",{options:{heightToWidth:3/4,windowRatio:1/2,windowMin:1/3,windowMax:15/20,dfd:new jQuery.Deferred(),shoe_css:{left:"26%",top:"5%"},pot_css:{left:"45%",top:"24%"},chipSizes:[1000000,250000,50000,10000,2500,500,100,25,5,1],gameChoices:{1:"NL Hold'em",2:"FL Hold'em (Jokers Wild)",3:"PL Omaha",4:"PL Omaha Hi-Lo",5:"NL Badugi",6:"NL Crazy Pineapple",7:"PL 5 Card Omaha",8:"PL 5 Card Omaha Hi-Lo",9:"PL Courcheval",10:"PL Courcheval Hi-Lo",11:"NL 5 Card Draw",12:"NL 2-7 Single Draw",13:"NL 2-7 Triple Draw",14:"NL Badacey",15:"NL Badeucy",16:"NL A-5 Single Draw",17:"NL A-5 Triple Draw",18:"NL Pineapple",19:"NL 5 Card Draw (Jokers Wild)",20:"NL 5 Card Draw (Deuces Wild)",21:"FL 7 Card Stud",22:"FL 7 Card Stud Hi-Lo",23:"FL Razz",24:"FL High Chicago",25:"FL 7 Card Stud (Jokers Wild)",26:"FL Follow the Queen",27:"FL The Bitch"},gameClass:{dealers:"Dealer's Choice",holdem:"Hold'em",holdemjokers:"Hold'em (Jokers Wild)",omaha:"Omaha",omahahilo:"Omaha Hi-Lo",badugi:"Badugi",crazypine:"Crazy Pineapple",omahafive:"5 Card Omaha",omahafivehilo:"5 Card Omaha Hi-Lo",courcheval:"Courcheval",courchevalhilo:"Courcheval Hi-Lo",fivedraw:"5 Card Draw",singledraw27:"2-7 Single Draw",tripledraw27:"2-7 Triple Draw",badacey:"Badacey",badeucy:"Badeucy",singledrawa5:"A-5 Single Draw",tripledrawa5:"A-5 Triple Draw",pineapple:"Pineapple",drawjokers:"5 Card Draw (Jokers Wild)",drawdeuces:"5 Card Draw (Deuces Wild)",sevenstud:"7 Card Stud",sevenstudhilo:"7 Card Stud Hi-Lo",razz:"Razz",highchicago:"High Chicago",sevenstudjokers:"7 Card Stud (Jokers Wild)",ftq:"Follow the Queen",bitch:"The Bitch"},login_info:{d:{handle:"Dealer",color:"black"},k:{handle:"Kibitz",color:"blue"}},chair_info:{},chair_count:0},_create:function(){var e=this,n=e.options,l=e.element;n.cardSnd=new Audio("snd/cardPlace3.ogg");n.betSnd=new Audio("snd/betSnd.ogg");n.pokerMain=c("#poker-main");n.chatBox=c("<div />").addClass("chat-box");var h=c("<input />").addClass("chat-input").attr({type:"text",maxlength:30});var g=c("<form />").addClass("chat-form").append(h).submit(function(i){i.preventDefault();var o=/^[\w\s\.\,\?!@#\$%^&\*\(\)_]{0,30}$/;if(o.test(h.val())){n.pokerMain.main("table_chat",{table_id:n.table_id,message:h.val()})}h.val("")});var k=n.small_blind+"/"+n.big_blind;var m="";if(n.game_class!=="dealers"){m+=n.limit+" "}m+=n.gameClass[n.game_class];l.addClass("ui-widget ui-front stacked table "+n.game_class).attr({"chair-count":n.chair_count,"game-choice":n.game_class}).append(c("<div />").addClass("table-wall"),c("<div />").addClass("header-main"),c("<div />").addClass("header-info").html("Table#"+n.table_id+" "+k+" "+m+" ").append(c("<div />").addClass("choice-info")),c("<div />").addClass("choice-info"),c("<div/>").addClass("header-icon header-icon-resize header-icon-max").click(function(){e._resizeMax(c(this))}),c("<div/>").addClass("header-icon header-icon-close").click(function(){n.pokerMain.main("unwatch_table",{table_id:n.table_id})}),c("<div />").addClass("board"),c("<div />").addClass("community"),c("<div />").addClass("pot"),c("<div />").addClass("panel-box").append(c("<div />").addClass("chat-button"),c("<div />").addClass("notes-button"),c("<div />").addClass("stats-button"),c("<div />").addClass("info-button")),g,n.chatBox,c("<div />").addClass("notes-box"),c("<div />").addClass("stats-box"),c("<div />").addClass("info-box"),c("<div />").addClass("slider-box").append(c("<div />").addClass("bet-slider"),c("<input />").addClass("bet-amount").attr({type:"text"})),c("<div />").addClass("action-box").append(c("<div />").addClass("action").attr({no:0}),c("<div />").addClass("action").attr({no:1}),c("<div />").addClass("action").attr({no:2})),c("<div />").addClass("table-msg table-mod"));e.buildSelector();for(var f=0;f<n.chair_count;f++){l.append(c("<div />").addClass("seat seat"+f).attr("pos",f));e.player_unjoin({chair:f,table_id:n.table_id})}l.resizable({aspectRatio:true,resize:function(i,o){c(this).css("font-size",(o.size.width/40))}});l.draggable({stack:".stacked",stop:function(){var i=c(".stacked").css("z-index");c(this).css("z-index",i+1)},create:function(){var i=c(".stacked").css("z-index");c(this).css("z-index",i+1)},containment:"window"});c.each(n,function(i,o){e._setOption(i,o)});e.resizeTable(n.windowRatio)},_tableMsg:function(h){var f=this.element.find(".table-msg.table-mod"),i=c("<div />").addClass("table-mes").html(h),e=c("<button />").addClass("modal-ok center").html("OK"),g=f.width();f.append(i,e.click(function(){f.children().remove();f.hide()})).show()},_sweep_pot:function(){var e=this,h=e.options,g=e.element;var f=g.find(".seat .stack");f.find(".chip, .size").animate(h.pot_css,"slow",function(){f.empty()})},buildSelector:function(){var e=this,i=e.options,h=e.element;var f='<option value="none" selected="selected">Select a game</option>';c.each(i.gameChoices,function(m,l){f+='<option value="'+m+'">'+l+"</option>"});var g=c("<select />").addClass("dealer-select").html(f).change(function(){c(".dealer-form").submit()});c("<form />").addClass("dealer-form").append(g).submit(function(k){k.preventDefault();i.pokerMain.main("pick_game",{table_id:i.table_id,game:g.val()});g.val("none")}).hide().appendTo(h)},_destroy:function(){},destroy:function(){},_resizeMin:function(f){var e=this,h=e.options,g=e.element;f.off();e.resizeTable(h.windowMin);f.removeClass("header-icon-min").addClass("header-icon-max").click(function(){e._resizeMax(f)})},_resizeMax:function(f){var e=this,h=e.options,g=e.element;f.off();e.resizeTable(h.windowMax);f.removeClass("header-icon-max").addClass("header-icon-min").click(function(){e._resizeMin(f)})},resizeTable:function(n,p,f){var g=this.options,i=c(b),h=i.width(),k=i.height(),m=h*n,e=m*g.heightToWidth;f=f?f:((h-m)/2);p=p?p:((k-e)/2);this.element.css({position:"absolute",width:(m)+"px",height:(e)+"px",fontSize:(m/40),top:p,left:f})},_buildStack:function(f,e){var l=this.options.chipSizes;var g=0;var k=l[g];var o={};e.children().remove();if(!f){return}var h=function(i){if(i>=k){i-=k;o[k]|=0;o[k]++}else{k=l[g++];if(!k){return}}h(i)};h(f*100);var m=0;c.each(l,function(p,n){if(n in o){m++;var q=c("<div />").addClass("stack"+m);for(j=0;j<o[n];j++){q.append(c("<div />").addClass("chip chip"+n).attr("pos",j))}e.append(q)}});e.append(c("<div />").addClass("size",f).html(f).css("width",m*4+"%"))},adjust_pos:function(f){var e=this,i=e.options,h=e.element,g=h.children(".seat");g.each(function(n){var l=n-f;if(l<0){l+=i.chair_count}var p=c(this);var m=p.clone(true);h.append(m);var o={seated:m.children(".seated-graphic"),avitar:m.children(".avitar-graphic"),open:m.children(".open-graphic"),titlebar:m.children(".titlebar"),chips:m.children(".chips"),size:m.find(".size"),button:m.children(".button"),card:m.children(".card"),chip:m.find(".chip")};p.attr("pos",l);var k={seated:p.children(".seated-graphic").css(["left","top"]),avitar:p.children(".avitar-graphic").css(["left","top"]),open:p.children(".open-graphic").css(["left","top"]),titlebar:p.children(".titlebar").css(["left","top"]),chips:p.children(".chips").css(["left","top"]),size:p.find(".size").css(["left","top"]),button:p.children(".button").css(["left","top"]),card:p.children(".card").css(["left","top"]),chip:p.find(".chip").css(["left","top"])};p.hide();c.each(o,function(q,r){r.animate(k[q],800,function(){m.remove();p.show()})})})},table_chips_res:function(e){},join_ring_res:function(f){var e=this,h=e.options,g=e.element;if(f.success){e.adjust_pos(f.chair)}},notify_join_hydra:function(f){var e=this,h=e.options,g=e.element;c.each(f.hydra_chairs,function(k,l){e.notify_join_table({login_id:f.login_id,chips:f.chips,handle:f.handle,chair:l})})},notify_join_table:function(f){var e=this,h=e.options,g=e.element;var i=g.find(".seat"+f.chair).attr("login_id",f.login_id);i.attr("status","seated").children(".open-graphic").remove();i.append(c("<div />").addClass("seated-clear"),c("<div />").addClass("seated-graphic"),c("<div />").addClass("avitar-graphic"),c("<div />").addClass("chips").html(f.chips),c("<div />").addClass("stack"),c("<div />").addClass("game-action").hide(),c("<div />").addClass("titlebar").html(f.handle));h.login_info[f.login_id]={handle:f.handle,color:f.color};h.chair_info[f.chair]=f},player_unjoin:function(f){var e=this,h=e.options,g=e.element;delete h.login_info[f.login_id];delete h.chair_info[f.chair];var i=g.find(".seat"+f.chair).attr("status","open");i.children().not(".button, .stack").remove()},player_snap:function(g){var e=this,h=e.options,f=e.element;c.each(g,function(l,k){e.player_update(k)})},player_update:function(h){var f=this,i=f.options,g=f.element;var k=g.find(".seat"+h.chair);var e={in_pot_this_round:function(m){var l=k.children(".stack");f._buildStack(m,l)},cards:function(l){k.children(".card").remove();k.attr("hole_count",l.length);c.each(l,function(m,n){n=n||"cb";k.append(c("<div />").addClass("card c"+n).attr({hole:m}))})},chips:function(l){k.children(".chips").html(l)},handle:function(l){i.login_info[h.login_id].handle=l},sit_out:function(l){},is_in_hand:function(l){}};c.extend(i.chair_info[h.chair],h);c.each(h,function(m,l){if(m in e){e[m](l)}})},table_snap:function(g){var e=this,h=e.options,f=e.element;h.dfd.resolve();e.table_update(g);c.each(h.chair_info,function(l,i){if(i.login_id&&i.login_id==h.login_id){e.adjust_pos(l);return false}})},table_update:function(h){var f=this,i=f.options,g=f.element;var e={community:function(m){var l=g.children(".community");l.children().remove();c.each(m,function(o,n){l.append(c("<div />").addClass("card com"+o+" c"+n))})},pot:function(l){var m=g.find(".pot");if(l){m.html("Pot: "+l)}else{m.empty()}},game_choice:function(m){var l=": "+h.limit+" "+i.gameClass[h.game_choice];g.find(".choice-info").html(l);g.attr("game-choice",h.game_choice)},round:function(l){i.round=l;g.attr("round",l)},button:function(l){g.find(".seat .button").remove();g.find(".seat"+l).append(c("<div />").addClass("button active"))},valid_act:function(l){i.valid_act=l},call_amt:function(l){i.call_amt=parseFloat(l)},small_bet:function(l){i.small_bet=parseFloat(l)},max_bet:function(l){i.max_bet=parseFloat(l)},max_discards:function(l){i.max_discards=l},min_discards:function(l){i.min_discards=l},max_draws:function(l){i.max_draws=l},min_draws:function(l){i.min_draws=l},bring:function(l){i.bring=parseFloat(l)},hide_buttons:function(){f._hide_buttons()},auto_play:function(l){i.auto_play=l},action:function(m){i.action=m;f._hide_buttons();var l=g.find(".seat").removeClass("active");l.find(".card.selected").removeClass("selected").animate({opacity:"1",top:"+=2%"},"fast",function(){})}};c.each(h,function(l,m){if(l in e){e[l](m)}});if(typeof h.action=="number"){var k=g.find(".seat"+h.action).addClass("active");if(i.chair_info[i.action].login_id==i.login_id){f._show_buttons(h);if(i.max_discards||i.max_draws){k.children(".card").each(function(){var l=c(this).attr("hole");c(this).click(function(){f._select_discard(l)})})}}}},_select_discard:function(h){var e=this,l=e.options,k=e.element;var n=k.children(".seat"+l.action);var g=l.max_discards||l.max_draws;var f=n.children(".card[hole="+h+"]");var m=n.children(".card.selected").length;if(f.hasClass("selected")){f.animate({opacity:"1",top:"+=2%"},"fast",function(){});f.removeClass("selected")}else{if(m<g){f.animate({opacity:".5",top:"-=2%"},"fast",function(){});f.addClass("selected")}}},move_button:function(f){var e=this.element;var i=e.find(".seat .button");var h=c("<div />").addClass("button");e.find(".seat"+f.button).append(h);var g=h.css(["left","top"]);h.hide();i.animate(g,"slow",function(){h.show();i.remove()})},notify_post:function(h){var e=this,i=e.options,g=e.element;var k=g.children(".seat"+h.chair);e._notify_act(h.chair,"Post "+h.chips);e.player_update({chair:h.chair,in_pot_this_round:h.in_pot});var f=k.children(".chips").html();k.children(".chips").html(parseFloat(f)-parseFloat(h.chips))},new_game:function(e){this._clear_table()},_clear_table:function(g){var e=this,h=e.options,f=e.element;e.table_update({auto_play:false});f.find(".pot").empty();f.find(".pot-stack").remove();f.find(".seat .stack").children().remove();f.find(".seat .card").remove();f.find(".community").children().remove();f.find(".dealer-select").val("none")},end_game:function(g){var e=this,h=e.options,f=e.element;f.find(".dealer-form").hide();f.find(".seat.active").removeClass("active");e._hide_buttons();e._sweep_pot()},showdown:function(g){var e=this,h=e.options,f=e.element;e.player_update({chair:g.chair,cards:g.cards})},high_winner:function(g){var e=this,h=e.options,f=e.element;h.dfd.promise().then(function(){e._payout(g)})},low_winner:function(g){var e=this,h=e.options,f=e.element;h.dfd.promise().then(function(){setTimeout(function(){e._payout(g)},800)})},_payout:function(i){var g=this,l=g.options,h=g.element;var e=c("<div/>").addClass("stack pot-stack");h.append(e);var f=h.find(".seat"+i.chair+" .stack");g._buildStack(i.payout,e);g._buildStack(i.payout,f);var k=f.find(".chip").first().css(["left","top"]);f.hide();h.find(".pot").empty();setTimeout(function(){e.find(".chip, .size").animate(k,"slow",function(){f.show();e.remove();g.player_update({chair:i.chair,chips:i.chips})})},1500)},_notify_act:function(e,i){var k=this.element.children(".seat"+e);var g=k.children(".chips, .titlebar").hide();var f=k.children(".game-action").html(i).show();setTimeout(function(){g.show();f.hide()},2000)},notify_bet:function(g){var e=this,h=e.options,f=e.element;var i=this.element.children(".seat"+g.chair);h.dfd.promise().then(function(){e._notify_act(g.chair,"Bet");e.player_update({chair:g.chair,in_pot_this_round:g.in_pot_this_round});i.children(".chips").html(g.balance);e.options.betSnd.play()})},notify_check:function(e){var f=this.element.children(".seat"+e.chair);this._notify_act(e.chair,"Check")},notify_fold:function(e){this._notify_act(e.chair,"Fold");var f=this.element.children(".seat"+e.chair);f.children(".card").remove()},notify_discard:function(h){var f=this,i=f.options,g=f.element;f._notify_act(h.chair,"Discard");var k=g.children(".seat"+h.chair);var e=k.children(".card").filter(function(){var m=c(this).attr("hole");var l=h.card_idx.indexOf(parseInt(m));if(l>=0){return true}else{return false}});e.animate(i.shoe_css,"slow",function(){c(this).remove();var l=k.children(".card");l.each(function(m){c(this).attr("hole",m)});k.attr("hole_count",l.length)})},notify_draw:function(g){var e=this,h=e.options,f=e.element;e._notify_act(g.chair,"Draw");var i=f.children(".seat"+g.chair);c.each(g.card_map,function(n,k){k=k||"cb";var m=i.children(".card[hole="+n+"]");var l=m.css(["left","top"]);m.animate(h.shoe_css,"slow",function(){m.removeClass().addClass("shoe card ccb")}).animate(l,"slow",function(){m.remove();i.append(c("<div/>").addClass("card c"+k).attr("hole",n))})});h.cardSnd.play()},deal_hole:function(h){var f=this,i=f.options,g=f.element;c.extend(i.chair_info[h.chair],h);var k=g.children(".seat"+h.chair);var e=k.children(".card").length;k.attr("hole_count",h.cards.length+e);c.each(h.cards,function(o,l){l=l||"cb";var p=c("<div />").addClass("shoe card ccb");var n=c("<div />").addClass("card").attr("hole",e++);k.append(n);var m=n.css(["left","top","margin-left","margin-top"]);g.append(p);p.animate(m,"slow",function(){n.addClass("c"+l);p.remove()})});i.cardSnd.play()},table_opts_res:function(h){var f=this,i=f.options,g=f.element;var e={sit_out:function(k){},wait_bb:function(k){},auto_rebuy:function(k){},auto_muck:function(k){}};c.each(h,function(m,l){if(m in e){e[m](l)}})},pick_game_res:function(e){if(e.success){this.element.find(".dealer-form").hide()}},bet_res:function(e){if(e.success){this._hide_buttons()}},check_res:function(e){if(e.success){this._hide_buttons()}},fold_res:function(e){if(e.success){this._hide_buttons()}},discard_res:function(e){if(e.success){this._hide_buttons()}},draw_res:function(e){if(e.success){this._hide_buttons()}},_hide_buttons:function(g){var e=this,h=e.options,f=e.element;f.find(".seat .card").off("click");f.find(".action").off().hide();f.find(".bet-slider").hide();f.find(".bet-amount").hide()},_show_buttons:function(e){var n=this,i=n.options,k=n.element;var h=k.find(".seat.active");var p=k.find(".bet-slider");var m=k.find(".bet-amount");var f=i.chair_info[i.action].chips;var g;if(i.hydra_flag){n.adjust_pos(i.action)}if(f>i.call_amt){g=i.call_amt+i.small_bet+((i.call_amt+i.small_bet)%i.small_bet);g=g>f?f:g;g=g>i.max_bet?i.max_bet:g}var l={bet:function(u){if(i.call_amt){var t=k.find(".action[no='1']");t.css("padding-top",".3%");t.html("Call <br />"+i.call_amt);t.click(function(){i.pokerMain.main("bet",{table_id:i.table_id,chips:i.call_amt})});t.show()}if(g){var q=k.find(".action[no='2']");var v=k.find(".bet-slider");var o=k.find(".bet-amount");q.css("padding-top",".3%");q.html('Raise <br /><div class="raise"></div>');q.click(function(){i.pokerMain.main("bet",{table_id:i.table_id,chips:o.val()})});var w=k.find(".raise");v.slider({value:g,min:g,max:i.max_bet,step:i.small_bet,slide:function(r,s){o.val(s.value);w.html(s.value)}});o.val(v.slider("value"));w.html(v.slider("value"));if(g<i.max_bet){v.show();o.show()}q.show()}},check:function(q){var o=k.find(".action[no='1']");o.css("padding-top","2%");o.html("Check");o.click(function(){i.pokerMain.main("check",{table_id:i.table_id})});o.show()},fold:function(q){var o=k.find(".action[no='0']");o.css("padding-top","2%");o.html("Fold");o.click(function(){i.pokerMain.main("fold",{table_id:i.table_id})});o.show()},discard:function(){var q=parseInt(i.min_discards)>0?1:2;var o=k.find(".action[no='"+q+"']");o.css("padding-top","2%");o.html("Discard");o.click(function(){var s=h.find(".card");var r=[];s.each(function(){if(c(this).hasClass("selected")){var t=c(this).attr("hole");r.push(t)}});if(r.length<=i.max_discards&&r.length>=i.min_discards){i.pokerMain.main("discard",{table_id:i.table_id,card_idx:r})}});o.show()},draw:function(){var o=k.find(".action[no='2']");o.css("padding-top","2%");o.html("Draw");o.click(function(){var r=h.find(".card");var q=[];r.each(function(s){if(c(this).hasClass("selected")){var t=c(this).attr("hole");q.push(t)}});if(q.length<=i.max_draws&&q.length>=i.min_draws){i.pokerMain.main("draw",{table_id:i.table_id,card_idx:q})}});o.show()},choice:function(){k.find(".dealer-form").show()},bring:function(){var q=k.find(".action[no=1]");var o=k.find(".action[no=2]");q.css("padding-top",".3%");q.html("Bring <br />"+i.bring);o.css("padding-top",".3%");o.html("Bring <br />"+i.small_bet);q.click(function(){i.pokerMain.main("bet",{table_id:i.table_id,chips:i.bring})});q.show();o.click(function(){i.pokerMain.main("bet",{table_id:i.table_id,chips:i.max_bet})});o.show()}};c.each(i.valid_act,function(q,o){if(o in l){l[o](q)}})},notify_pick_game:function(g){var e=this,h=e.options,f=e.element;e.table_update(g)},notify_message:function(g){var e=this,i=e.options,f=e.element;var k=i.login_info[g.from]||i.login_info.k;var h=k.handle;i.chatBox.append(c("<div />").addClass("chat-msg").append(c("<a />").addClass("chat-handle").html(h).css("color",k.color),c("<span />").html(": "+g.message)));i.chatBox.animate({scrollTop:i.chatBox[0].scrollHeight})},begin_new_action:function(g){var e=this,h=e.options,f=e.element;h.dfd.promise().then(function(){f.find(".seat.active").removeClass("active");f.find(".seat"+g.action).addClass("active");e.table_update({small_bet:g.small_bet,max_bet:g.max_bet,valid_act:g.valid_act,max_discards:g.max_discards,min_discards:g.min_discards,max_draws:g.max_draws,min_draws:g.min_draws,bring:g.bring,call_amt:g.call_amt,action:g.action})})},begin_new_round:function(g){var e=this,h=e.options,f=e.element;e._sweep_pot();e.table_update({pot:g.pot,auto_play:g.auto_play,round:g.round});h.dfd=new jQuery.Deferred();setTimeout(function(){h.dfd.resolve()},600)},deal_community:function(i){var e=this,k=e.options,h=e.element;var g=h.find(".community");var f=h.find(".seat .stack .chip");k.dfd.promise().then(function(){var m=g.children().length;c.each(i.community,function(p,l){var q=c("<div />").addClass("shoe card c"+l);var o=c("<div />").addClass("card com"+m+++" c"+l);h.append(q);g.append(o);var n=o.css(["left","top"]);o.hide();q.animate(n,"slow",function(){o.show();q.remove()});k.cardSnd.play()})});f.children().remove()},_setOption:function(f,h){var e=this,i=e.options,g=e.element;i[f]=h}})})(jQuery,window,document);