(function(h,e,f,g){h.widget("poker.lobby",{options:{widthToHeight:4/3,epochDiff:0,inchan:{},colData:{1:["Id","int"],2:["Stakes","string"],3:["Limit","string"],4:["Seats","int"],5:["Plrs","string"],6:["Wait","int"],7:["Avg Pot","int"],8:["Plrs/Flop","int"],9:["H/hr","int"],10:["Start","int"],11:["Game","string"],12:["Buy-In","int"],13:["State","string"],14:["Enrolled","int"],15:["Table","int"],16:["Speed","string"],17:["Login","string"],18:["Name","string"],19:["Location","string"],20:["Player","string"],21:["Chips","int"],22:["Seat","int"],23:["Block","int"],24:["Player Pool","int"],25:["Rank","int"],26:["Rating","int"]},ringCols:[1,11,2,3,4,5,7,8,9],leaderCols:[25,20,26],socialCols:[17,18,19],hydraCols:[1,11,2,3,4,24],loginData:{},ringData:{},fastData:{},gameState:{0:"Closed",1:"Registering",2:"Late Reg.",3:"Full",4:"Playing",6:"Complete"},gameTabs:{dealers:["Dealer's Choice",1],holdem:["Hold'em",1],holdemjokers:["Hold'em (Jokers Wild)",1],pineapple:["Pineapple",1],crazypine:["Crazy Pineapple",1],omaha:["Omaha",1],omahahilo:["Omaha Hi-Lo",1],omahafive:["5 Card Omaha",2],omahafivehilo:["5 Card Omaha Hi-Lo",2],courcheval:["Courcheval",2],courchevalhilo:["Courcheval Hi-Lo",2],fivedraw:["5 Card Draw",2],drawjokers:["5 Card Draw (Jokers Wild)",2],drawdeuces:["5 Card Draw (Deuces)",3],singledraw27:["2-7 Single Draw",3],tripledraw27:["2-7 Triple Draw",3],singledrawa5:["A-5 Single Draw",3],tripledrawa5:["A-5 Triple Draw",3],sevenstud:["7 Card Stud",3],razz:["Razz",3],sevenstudhilo:["7 Card Stud Hi-Lo",4],sevenstudjokers:["7 Card Stud (Jokers)",4],highchicago:["High Chicago",4],ftq:["Follow the Queen",4],bitch:["The Bitch",4],badugi:["Badugi",4],badacey:["Badacey",4],badeucy:["Badeucy",4]}},_create:function(){var s=this,p=s.options,o=s.element;var a=h("<div />").attr("id","tabs");var b=h("<div />").attr({id:"game-tabs1",type:"game"});var c=h("<div />").attr({id:"game-tabs2",type:"game"});var d=h("<div />").attr({id:"game-tabs3",type:"game"});var m=h("<div />").attr({id:"game-tabs4",type:"game"});var r=h("<input />").attr({id:"social-input",type:"text",maxlength:30});var n=o.addClass("ui-widget").append(h("<div />").attr("id","lobby-header"),h("<div />").attr("id","lobby-leader").append(s._buildTable(p.leaderCols)),h("<div />").attr("id","lobby-countdown"),h("<div />").attr("id","lobby-adspace"),h("<div />").attr("id","lobby-logins"),h("<div/>").attr("id","welcome"),h("<button />)").attr("id","lobby-red").html("Log-In").click(function(){h("#login-box").show();h("#login-name").focus()}),h("<div />").attr("id","login-box").addClass("lobby-modal"),h("<div />").attr("id","modal-box").addClass("lobby-modal"),h("<div />").attr("id","new-account").addClass("lobby-modal"),h("<div />").attr("id","ring-info").addClass("tab-info games").append(s._buildTable(p.ringCols)),a.append(b.append(h("<button />").attr({id:"all-tab",info:"all"}).addClass("lobby-tab").html("All")),c,d,m),h("<div />").attr("id","social-box").append(h("<div />").attr("id","chat-header"),h("<div />").attr("id","main-chat"),h("<form />").attr("id","social-form").append(r).submit(function(i){i.preventDefault();var l=/^[\w\s\.\,\?!@#\$%^&\*\(\)_]{0,30}$/;if(l.test(r.val())){var j="main";h("#poker-main").main("write_channel",{channel:j,message:r.val()})}r.val("")})));h.each(p.gameTabs,function(j,i){o.find("#game-tabs"+i[1]).append(h("<button />").attr({id:j+"-tab",info:j}).addClass("lobby-tab").html(i[0]))});n.on("click","#tabs .lobby-tab",function(){var i=h(this);o.find("#tabs > [type="+i.parent().attr("type")+"] .lobby-tab.select").removeClass("select");i.addClass("select")}).on("click","#tabs > [type=game] .lobby-tab",function(){var j=h(this).attr("info");var i=o.find(".tab-info.games tbody tr");if(j=="all"){i.show()}else{i.filter("[game_class="+j+"]").show();i.filter("[game_class!="+j+"]").hide()}}).on("click",".tab-info tbody tr",function(){var i=h(this);i.siblings().removeClass("select");i.addClass("select")}).on("click","#ring-info tbody tr",function(){var i=h(this).attr("table_id");h("#poker-main").main("watch_table",{table_id:i})}).on("dblclick","#tour-info tbody tr",function(){var i=h(this).attr("tour_id");h("#poker-main").main("watch_tour",{tour_id:i})}).on("mouseenter","button.lobby-tab",function(){h(this).addClass("tab-hover")}).on("mouseleave","button.lobby-tab",function(){h(this).removeClass("tab-hover")});h(e).resize(function(){s.resizeLobby()});s.resizeLobby();s._buildLogin();s._buildReg();r.focus()},_filter_money:function(d){var j=this,a=j.options,c=j.element;var b=c.find(".tab-info.games.select tbody tr:visible");if(d=="real"){b.filter("[did!=1]").show();b.filter("[did=1]").hide()}else{if(d=="play"){b.filter("[did=1]").show();b.filter("[did!=1]").hide()}}},watch_table_res:function(c){var d=this,a=d.options,b=d.element;h("#table-ring").append(h("<div />").attr("id","tring"+c.table_id).table_ring(c))},_destroy:function(){},destroy:function(){},_buildReg:function(){var p=this,r=p.options,c=p.element,q=h("<input />").attr({id:"signup-name",name:"username",placeholder:"Username",type:"text",maxlength:12,pattern:"[A-Za-z]([0-9a-zA-Z_]){3,12}"}).prop({autofocus:true,required:true}),o=h("<input />").attr({id:"signup-email",placeholder:"Email (optional)",maxlength:30,name:"email",type:"email"}).prop({required:true}),d=h("<input />").attr({id:"signup-pass",placeholder:"Password",maxlength:12,name:"password",type:"password"}).prop({required:true}),a=h("<input />").attr({id:"confirm-pass",placeholder:"Confirm Password",maxlength:12,name:"password",type:"password"}).prop({required:true});var b=c.find("#new-account");b.append(h("<div />").addClass("modal-header").html("Create New Account"),h("<form />").attr("id","signup-form").append(h("<div />").attr("id","signup-un").html("Username:"),q,h("<div />").attr("id","signup-pw").html("Password:"),d,h("<div />").attr("id","signup-cp").html("Password:"),a,h("<div />").attr("id","signup-em").html("Email:"),o).submit(function(i){i.preventDefault();b.hide();if(d.val()!==a.val()){p.modal_message("Passwords don't match")}else{var j={username:q.val(),password:d.val()};if(o.val()){j.email=o.val()}h("#poker-main").main("register",j)}}),h("<button />").addClass("modal-ok").html("OK").click(function(){h("#signup-form").submit()}),h("<button />").addClass("modal-cancel").html("Cancel").click(function(){b.hide()}))},register_res:function(a){var b=this;var c;if(a.success){c="Registered! Welcome "+a.username+"!";b.login_success(a)}else{c=a.message}this.modal_message(c)},_buildLogin:function(){var m=this,a=m.options,c=m.element,b=c.find("#login-box"),n=h("<input />").attr({id:"login-name",name:"username",placeholder:"Username",type:"text",maxlength:12,pattern:"[A-Za-z]([0-9a-zA-Z_]){3,12}"}).prop({autofocus:true,required:true}),d=h("<input />").attr({id:"login-pass",placeholder:"Password",maxlength:12,name:"password",type:"password"}).prop({required:true});b.append(h("<div />").addClass("modal-header").html("Log-In"),h("<form />").attr("id","login-form").append(h("<div />").attr("id","label-name").html("Username:"),n,h("<div />").attr("id","label-pass").html("Password:"),d).submit(function(i){i.preventDefault();h("#poker-main").main("login",{username:n.val(),password:d.val()});b.hide()}),h("<button />").attr({id:"login-create"}).html("Create New Account").click(function(){b.hide();h("#new-account").show();h("#signup-name").focus()}),h("<button />").addClass("modal-ok").html("OK").click(function(){h("#login-form").submit()}),h("<button />").addClass("modal-cancel").html("Cancel").click(function(){b.hide()}))},_updateClock:function(){var o=this,c=o.options,n=o.element;var d=(new Date).toTimeString().split(/\s/);var a=d[2].replace(/\W/g,"");var m=d[0].split(":");var b=m[0]+":"+m[1]+" "+a;n.find("#lobby-clock").html(b)},_buildTable:function(b){var j=this,a=j.options,c=j.element;var d="";h.each(b,function(i,p){var q=a.colData[p][0];var n=a.colData[p][1];d+='<th data-sort-dir="asc" data-sort="'+n+'">'+q+"</th>"});return h("<div/>").addClass("table-box").append(h("<table />").append(h("<thead />").append(h("<tr>").html(d)),h("<tbody />")).stupidtable().bind("aftertablesort",function(o,q){$this=h(this);var p=$this.find("th");p.find(".arro").remove();var i=q.direction==="asc"?"↑":"↓";p.eq(q.column).append('<span class="arro">'+i+"</span>")}))},resizeLobby:function(i){var b=this.options,d=e.innerWidth*0.9,a=e.innerHeight*0.9,c=d/a;if(c>b.widthToHeight){d=a*b.widthToHeight}else{a=d/b.widthToHeight}this.element.css({height:a+"px",width:d+"px",marginTop:(-a/2)+"px",marginLeft:(-d/2)+"px",fontSize:(d/680)+"em"})},guest_login:function(c){var d=this,a=d.options,b=d.element;a.epochDiff=(new Date).getTime()-(c.epoch*1000);a.myData={login_id:c.login_id,username:c.username,chips:c.chips};d._updateClock();clearInterval(a.clockTimer);setTimeout(function(){d._updateClock();a.clockTimer=setInterval(function(){d._updateClock()},60000)},(62-(new Date).getSeconds()));b.find("#welcome").empty().append(h("<div/>").attr("id","username").html(a.myData.username),h("<div/>").attr("id","logout").html("&nbsp[ Logout ]").click(function(){h("#poker-main").main("logout")}))},modal_message:function(b){var c=this,l=this.element.find("#modal-box"),a=h("<div />").addClass("modal-mes").html(b),m=h("<button />").addClass("modal-ok center").html("OK"),d=l.width();l.append(a,m.click(function(){l.hide()})).show();setTimeout(function(){l.fadeOut(1200,function(){h(this).children().remove()})},2000)},_buildCashier:function(c){var d=this,a=d.options,b=d.element;b.append(h("<div />").attr("id","cashier").addClass("big-modal").append(h("<div />").attr("id","cash-head").html("CASHIER"),h("<div />").attr("id","cash-close").click(function(){h("#cashier").hide()}),h("<div />").attr("id","cash-one").append(h("<div />").attr("id","pers-head").addClass("head").html("Personal Information"),h("<div />").attr("id","cash-user").addClass("cash-block").append(h("<div />").addClass("cash-cat").html("Username:"),h("<div />").addClass("cash-det")),h("<div />").attr("id","cash-email").addClass("cash-block").append(h("<div />").addClass("cash-cat").html("Email:"),h("<div />").addClass("cash-det")),h("<div />").attr("id","cash-deposit").addClass("cash-block").append(h("<div />").addClass("cash-cat").html("Rating:"),h("<div />").addClass("cash-det").html("0"))),h("<div />").attr("id","cash-two").append(h("<div />").attr("id","acct-head").addClass("head").html("Account Balance"),h("<div />").attr("id","play-head").addClass("head").html("PLAY MONEY"),h("<div />").attr("id","play-avail").addClass("cash-block").append(h("<div />").addClass("cash-cat").html("Available:"),h("<div />").addClass("cash-det")),h("<div />").attr("id","play-inplay").addClass("cash-block").append(h("<div />").addClass("cash-cat").html("In Play:"),h("<div />").addClass("cash-det")),h("<div />").attr("id","play-total").append(h("<div />").addClass("cash-cat").html("Total:"),h("<div />").addClass("cash-det"))),h("<div />").attr("id","cash-three").append(h("<button />").attr("id","cash-reload").html("Reload Chips").click(function(){h("#poker-main").main("reload")}),h("<button />").attr("id","cash-leave").html("Leave Cashier").click(function(){h("#cashier").hide()}))))},_updateCashier:function(){var d=this,a=d.options,b=d.element;var c;var j={username:function(i){h("#cash-user .cash-det").html(i)},email:function(i){h("#cash-email .cash-det").html(i)},chips:function(i){h("#real-avail .cash-det").html(0);h("#play-avail .cash-det").html(i[1])},ring_play:function(n){var i=0;var o=0;h.each(n,function(l,m){if(a.ringData[l].director_id==1){i+=m}else{o+=m}});c=i+a.myData.chips[1];h("#real-inplay .cash-det").html(o);h("#real-total .cash-det").html(o);h("#play-inplay .cash-det").html(i);h("#play-total .cash-det").html(c)}};h.each(a.myData,function(m,i){if(m in j){j[m](i)}});h("#cash-deposit .cash-det").html(c+"/"+a.myData.invested[1]+" = "+Math.round(c/a.myData.invested[1]*1000)/1000)},login_success:function(c){var d=this,a=d.options,b=d.element;a.myData=c;d._buildCashier();b.find("#lobby-red").html("Cashier").off("click").click(function(){h("#poker-main").main("login_info")});b.find("#username").html(a.myData.username)},login_res:function(c){var d=this,a=d.options,b=d.element;if(c.success){d.modal_message("Success! Welcome "+c.username+"!");d.login_success(c)}else{d.modal_message(c.message)}},login_update:function(c){var d=this,a=d.options,b=d.element;a.myData=c},login_info_res:function(c){var d=this,a=d.options,b=d.element;if(c.success){a.myData=c;d._updateCashier();h("#cashier").show()}else{d.modal_message(c.message)}},join_channel_res:function(c){var d=this,a=d.options,b=d.element;a.inchan[c.channel]=c.success?true:false},unjoin_channel_res:function(c){var d=this,a=d.options,b=d.element;a.inchan[c.channel]=c.success?false:true},notify_message:function(o){var p=this,b=p.options,n=p.element;if(b.loginData[o.from]&&b.loginData[o.from]["block"]){return}var a=b.loginData[o.from];var d=a?a.username:"Guest"+o.from;var c=a?a.color:"black";var q=n.find("#"+o.channel+"-chat");q.append(h("<div />").addClass("chat-msg").append(h("<a />").addClass("chat-handle").html(d).css("color",c),h("<span />").html(": "+o.message)));q.animate({scrollTop:q[0].scrollHeight})},notify_login:function(c){var d=this,a=d.options,b=d.element;this.notify_logout(c);c.color="rgb("+Math.floor(Math.random()*256)+","+Math.floor(Math.random()*256)+","+Math.floor(Math.random()*256)+")";a.loginData[c.login_id]=c;b.find("#social-info .table-box tbody").append(h("<tr />").attr("login_id",c.login_id).append(h("<td />").html(c.username),h("<td />").addClass("block yes").click(function(){var j=h(this);j.toggleClass("yes");if(j.hasClass("yes")){a.loginData[c.login_id]["block"]=true;j.html("Yes")}else{a.loginData[c.login_id]["block"]=false;j.html("No")}}).click()))},notify_logout:function(c){var d=this,a=d.options,b=d.element;delete a.loginData[c.login_id];b.find("#social-info .table-box tbody tr[login_id="+c.login_id+"]").remove()},ring_snap:function(c){var d=this,a=d.options,b=d.element;h.each(c,function(m,i){a.ringData[i.table_id]=i});d._build_ring_tab()},_build_ring_tab:function(){var d=this,a=d.options,b=d.element;var c=b.find("#ring-info tbody");c.empty();h.each(a.ringData,function(o,p){var n=p.small_blind+"/"+p.big_blind;var q=p.game_class=="dealers"?"--":p.limit;h("<tr />").attr({id:"lring"+o,table_id:p.table_id,did:p.director_id,game_class:p.game_class}).addClass("lring").append(h("<td />").addClass("table-id").html(p.table_id),h("<td />").html(a.gameTabs[p.game_class][0]),h("<td />").addClass().html(n),h("<td />").addClass().html(q),h("<td />").addClass().html(p.chair_count),h("<td />").addClass("plr-count"),h("<td />").addClass("avg-pot"),h("<td />").addClass("plrs-flop"),h("<td />").addClass("hhr")).appendTo(c);d._update_ring_tab(p)});b.find("#all-tab").trigger("click");b.find("#ring-info thead th:eq(5)").trigger("click")},notify_create_ring:function(c){var d=this,a=d.options,b=d.element;a.ringData[c.table_id]=c;d._build_ring_tab()},notify_destroy_ring:function(a){delete this.options.ringData[a.table_id];this.element.find("#lring"+a.table_id).remove()},notify_lr_update:function(c){var d=this,a=d.options,b=d.element;h.extend(a.ringData[c.table_id],c);d._update_ring_tab(c)},_update_ring_tab:function(d){var l=this,a=l.options,b=l.element;var c=b.find("#lring"+d.table_id);var m={avg_pot:function(i){c.find(".avg-pot").html(i)},plrs_flop:function(i){c.find(".plrs-flop").html(i)},hhr:function(i){c.find(".hhr").html(i)},plr_map:function(i){var o=c.find(".plr-count");var j=0;for(k in i){j++}o.html(j)}};h.each(d,function(j,i){if(j in m){m[j](i)}})},_msgHandler:function(a,b){var c={};if(a in c){c[a](b)}},_setOption:function(d,b){var l=this,a=l.options,c=l.element;var m={};if(d in m){a[d]=b;m[d](b)}}})})(jQuery,window,document);